<!DOCTYPE html>
<html lang="pt-PT">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Eco-Dicion√°rio ‚Ä¢ EcoQuiz Angola</title>
<link rel="stylesheet" href="style.css">
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0b0f10">

<!-- iOS PWA -->
<link rel="apple-touch-icon" href="icons/icon-192.png" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />


<style>
/* ===== CONTAINER ===== */
.dic-container {
    padding: 40px 7%;
}

.dic-title {
    text-align: center;
    font-size: 2.4rem;
    font-weight: 800;
    color: #0e7135;
}

.dic-sub {
    text-align: center;
    margin-top: 5px;
    margin-bottom: 35px;
    font-size: 1rem;
    color: #444;
}

/* ===== SEARCH BAR ===== */
.search-box {
    max-width: 700px;
    margin: 0 auto 30px;
    display: flex;
    gap: 12px;
}

.search-box input {
    width: 100%;
    padding: 14px 18px;
    border: 2px solid #0e713585;
    border-radius: 14px;
    font-size: 1.05rem;
    outline: none;
    transition: 0.2s;
}

.search-box input:focus {
    border-color: #16a34a;
    box-shadow: 0 0 10px rgba(20,170,60,0.2);
}

/* ===== FILTER LETTERS ===== */
.letters {
    text-align: center;
    margin-bottom: 28px;
}

.letters button {
    background: white;
    border: 1px solid #c8e8d2;
    padding: 8px 12px;
    margin: 4px;
    border-radius: 8px;
    cursor: pointer;
    transition: 0.2s;
}

.letters button:hover,
.letters button.active {
    background: #16a34a;
    color: white;
    border-color: #16a34a;
}

/* ===== RESULTADOS ===== */
.dic-list {
    max-width: 900px;
    margin: 0 auto;
}

.term {
    background: white;
    padding: 18px 22px;
    border-radius: 14px;
    box-shadow: 0 6px 12px rgba(0,0,0,0.06);
    margin-bottom: 18px;
    border-left: 6px solid #16a34a;
}

.term-title {
    font-size: 1.2rem;
    font-weight: 700;
    color: #0e7135;
    margin-bottom: 5px;
}

.highlight {
    background: yellow;
    padding: 2px 4px;
    border-radius: 4px;
}

/* Mobile */
@media (max-width: 600px) {
    .search-box { flex-direction: column; }
    .dic-title { font-size: 1.9rem; }
}
</style>
</head>

<body>

<header class="navbar">
    <div class="logo">
        <span class="logo-icon">üåç</span>
        <div class="logo-text">
            <h1>EcoQuiz Angola</h1>
            <p>Educa√ß√£o Ambiental Interativa</p>
        </div>
    </div>

    <!-- Bot√£o hamburguer -->
    <div class="hamburger" id="hamburger">
        <span></span>
        <span></span>
        <span></span>
    </div>

    <nav class="menu" id="menu">
        <a href="index.html"><span>üè†</span> Home</a>
        <a href="jogar.html"><span class="icon-jogar">üéÆ</span>Jogar</a>
        <a href="aprender.html"><span>üìö</span> Aprender</a>
        <a href="eco-dicion√°rio.html"  class="active"><span>üìñ</span> Eco-Dicion√°rio</a>
        <a href="#"><span>üë•</span> Sobre N√≥s</a>
        <a href="#" class="btn-apoio"><span>üíö</span> Apoie o Projecto</a>
	<button id="themeToggle" aria-label="Alternar tema" title="Alternar tema" class="theme-toggle">üåô</button>
	<button onclick="fetchAndRenderTerms(true)">Atualizar Base</button>


    </nav>
</header>

<div class="ecoDictionary">

    <h1 class="dic-title">üî§ Eco-Dicion√°rio</h1>
    <p class="dic-sub">Pesquisa por termos ambientais, conceitos e palavras-chave.</p>

    <!-- ===== SEARCH BAR ===== -->
<div class="search-box" id="search-bar-container" role="search" aria-label="Pesquisar Eco-Dicion√°rio" search-bar-container>
  <input type="search" id="searchInput" placeholder="Pesquisar termo..." aria-label="Pesquisar termo ou palavra-chave" />
  <button class="search-filter-btn">Filtrar ‚ñæ</button>
<div class="dropdown-letters" id="dropdownLetters">
    <div class="dropdown-scroll">
        <button data-letter="all">Todos</button>
        <button data-letter="A">A</button>
        <button data-letter="B">B</button>
        <button data-letter="C">C</button>
        <button data-letter="D">D</button>
        <button data-letter="E">E</button>
        <button data-letter="F">F</button>
        <button data-letter="G">G</button>
        <button data-letter="H">H</button>
        <button data-letter="I">I</button>
        <button data-letter="J">J</button>
        <button data-letter="K">K</button>
        <button data-letter="L">L</button>
        <button data-letter="M">M</button>
        <button data-letter="N">N</button>
        <button data-letter="O">O</button>
        <button data-letter="P">P</button>
        <button data-letter="Q">Q</button>
        <button data-letter="R">R</button>
        <button data-letter="S">S</button>
        <button data-letter="T">T</button>
        <button data-letter="U">U</button>
        <button data-letter="V">V</button>
        <button data-letter="W">W</button>
        <button data-letter="X">X</button>
        <button data-letter="Y">Y</button>
        <button data-letter="Z">Z</button>
    </div>
</div>

</div>


    <!-- ===== FILTER LETTERS ===== -->
    <div class="letters" id="letterFilter">
        <button data-letter="all" class="active">Todos</button>
    </div>
 <div id="dicListWrapper">
    <!-- ===== RESULTADOS ===== -->
<div class="dic-list" id="dicList" role="region" aria-live="polite" aria-label="Resultados do Eco-dicion√°rio"></div>
 </div>


</div>
<div id="ecoChat">
    <button id="chatToggle" title="Abrir EcoBot">ü§ñ</button>

    <div id="chatWindow">
        <div id="chatHeader">
            <strong>üå± EcoBot</strong>
            <div>
                <button id="clearChat" title="Limpar conversa">üßπ</button>
                <button id="closeChat" title="Fechar">‚úñ</button>
            </div>
        </div>

        <div id="chatMessages">
            <div class="bubble botMsg">
                <b>EcoBot:</b> Ol√° üëã! Sou o <i>EcoBot</i>, o teu assistente ambiental.
            </div>
        </div>

        <div id="chatInputArea">
            <input id="userMessage" placeholder="Escreve a tua pergunta..." />
            <button id="sendMessage">‚û§</button>
        </div>
    </div>
</div>

<script src="ecobot-db.js"></script>
<script src="eco-dicionario-data.js"></script>
<script>
/* ======================================================
   GERAR LETRAS DO FILTRO  ‚Äî vers√£o corrigida
====================================================== */
const letters = document.getElementById("letterFilter");
const list = document.getElementById("dicList");
const searchInput = document.getElementById("searchInput");

// cria bot√£o "Todos" s√≥ se n√£o existir
if (!letters.querySelector('button[data-letter="all"]')) {
  const allBtn = document.createElement("button");
  allBtn.type = "button";
  allBtn.dataset.letter = "all";
  allBtn.className = "active";
  allBtn.textContent = "Todos";
  allBtn.setAttribute('aria-pressed', 'true');
  letters.appendChild(allBtn);
}

// gerar A-Z (n√£o duplica "Todos")
const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split('');
alphabet.forEach(letter => {
  // evita adicionar bot√£o se j√° existir (por exemplo em re-render)
  if (letters.querySelector(`button[data-letter="${letter}"]`)) return;
  const btn = document.createElement("button");
  btn.type = "button";
  btn.dataset.letter = letter;
  btn.textContent = letter;
  btn.setAttribute('aria-pressed', 'false');
  letters.appendChild(btn);
});

/* ======================================================
   HELPERS / RENDER
====================================================== */
function stripDiacritics(str) {
  return String(str || '').normalize("NFD").replace(/[\u0300-\u036f]/g, "");
}

function escapeRegExp(string) {
  return String(string).replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

function createHighlightedNode(text, query) {
  if (!query) return document.createTextNode(text);
  const lcText = stripDiacritics(text).toLowerCase();
  const qlen = query.length;
  const frag = document.createDocumentFragment();
  let lastIndex = 0;
  let idx = lcText.indexOf(query, lastIndex);
  while (idx !== -1) {
    if (idx > lastIndex) {
      frag.appendChild(document.createTextNode(text.slice(lastIndex, idx)));
    }
    const origSub = text.slice(idx, idx + qlen);
    const span = document.createElement("span");
    span.className = "highlight";
    span.textContent = origSub;
    frag.appendChild(span);
    lastIndex = idx + qlen;
    idx = lcText.indexOf(query, lastIndex);
  }
  if (lastIndex < text.length) {
    frag.appendChild(document.createTextNode(text.slice(lastIndex)));
  }
  return frag;
}

function renderList(filterText = "", filterLetter = "all") {
  list.innerHTML = "";
  const query = String(filterText || "").trim().toLowerCase();
  const queryNorm = stripDiacritics(query);

  // ordena c√≥pia do array (n√£o altera ecoTerms original)
  const sorted = ecoTerms.slice().sort((a, b) =>
    a.t.localeCompare(b.t, 'pt', { sensitivity: 'base' })
  );

  sorted.forEach(item => {
    const firstChar = stripDiacritics(item.t[0] || '').toUpperCase();
    if (filterLetter !== "all" && firstChar !== filterLetter) return;

    const titleNorm = stripDiacritics(item.t).toLowerCase();
    if (queryNorm && !titleNorm.includes(queryNorm)) return;

    const div = document.createElement("div");
    div.className = "term";

    const titleDiv = document.createElement("div");
    titleDiv.className = "term-title";
    titleDiv.appendChild(createHighlightedNode(item.t, queryNorm));

    const descDiv = document.createElement("div");
    descDiv.className = "term-desc";
    descDiv.textContent = item.d;

    div.appendChild(titleDiv);
    div.appendChild(descDiv);
    list.appendChild(div);
  });

  if (!list.hasChildNodes()) {
    const empty = document.createElement('div');
    empty.className = 'term';
    empty.innerHTML = '<div class="term-title">Nenhum termo encontrado</div><div class="term-desc">Tenta outra palavra ou seleciona "Todos".</div>';
    list.appendChild(empty);
  }

/* ======================================================
     üî• AQUI ‚Äî scroll para o topo ap√≥s cada filtro/pesquisa
  ====================================================== */

  const wrapper = document.getElementById("dicListWrapper");
  if (wrapper) wrapper.scrollTop = 0;
}

/* ======================================================
   DEBOUNCE (corrigido) e EVENTOS
====================================================== */
function debounce(fn, wait = 200) {
  let t;
  return (...args) => {
    clearTimeout(t);
    t = setTimeout(() => fn(...args), wait);
  };
}

if (searchInput) {
  searchInput.addEventListener("input", debounce(() => {
    const activeBtn = letters.querySelector(".active");
    const activeLetter = activeBtn ? activeBtn.dataset.letter : "all";
    renderList(searchInput.value, activeLetter);
  }, 180));
}

/* filtro por letras (delegation) */
letters.addEventListener("click", e => {
  const btn = e.target.closest("button");
  if (!btn || !btn.dataset.letter) return;

  // atualizar estados visuais e aria
  letters.querySelectorAll("button").forEach(b => {
    b.classList.remove("active");
    b.setAttribute('aria-pressed', 'false');
  });

  btn.classList.add("active");
  btn.setAttribute('aria-pressed', 'true');

  const activeLetter = btn.dataset.letter;
  const queryText = searchInput ? searchInput.value : "";
  renderList(queryText, activeLetter);
});

/* ==================================================================
   Mostrar todos ao carregar
================================================================== */
document.addEventListener("DOMContentLoaded", () => {
  renderList("", "all");
});



</script>
<script>
const filterBtn = document.querySelector(".search-filter-btn");
const dropdown = document.getElementById("dropdownLetters");

/* Abrir/fechar dropdown */
filterBtn.addEventListener("click", (event) => {
    event.stopPropagation();
    const isVisible = dropdown.style.display === "block";
    dropdown.style.display = isVisible ? "none" : "block";
    filterBtn.textContent = isVisible ? "Filtrar ‚ñæ" : "Filtrar ‚ñ¥";
});

/* filtro por letras no DROPDOWN MOBILE */
dropdown.addEventListener("click", e => {
    const btn = e.target.closest("button");
    if (!btn || !btn.dataset.letter) return;

    const letter = btn.dataset.letter;
    const queryText = searchInput ? searchInput.value : "";

    // aplica o filtro
    renderList(queryText, letter);

    // ajustar estado visual do desktop
    letters.querySelectorAll("button").forEach(b => {
        b.classList.remove("active");
        b.setAttribute('aria-pressed', 'false');
    });

    const matchingDesktopBtn = letters.querySelector(`button[data-letter="${letter}"]`);
    if (matchingDesktopBtn) {
        matchingDesktopBtn.classList.add("active");
        matchingDesktopBtn.setAttribute('aria-pressed', 'true');
    }

    // fechar dropdown automaticamente
    dropdown.style.display = "none";
    filterBtn.textContent = "Filtrar ‚ñæ";
});


/* Fechar ao clicar fora */
document.addEventListener("click", () => {
    dropdown.style.display = "none";
    filterBtn.textContent = "Filtrar ‚ñæ";
});

</script>
<script>
const hamburger = document.getElementById("hamburger");
const menu = document.getElementById("menu");

hamburger.addEventListener("click", () => {
    hamburger.classList.toggle("active");
    menu.classList.toggle("active");
});

</script>

<script>
(function(){
  const root = document.documentElement;
  const toggle = document.getElementById('themeToggle');

  // read saved preference
  const saved = localStorage.getItem('eco_theme'); // 'dark' | 'light' | null
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

  function applyTheme(theme){
    if(theme === 'dark'){
      root.setAttribute('data-theme', 'dark');
      if(toggle) toggle.textContent = '‚òÄÔ∏è'; // mostra sol para permitir voltar
    } else {
      root.removeAttribute('data-theme');
      if(toggle) toggle.textContent = 'üåô';
    }
  }

  // init
  if(saved === 'dark' || (!saved && prefersDark)){
    applyTheme('dark');
  } else {
    applyTheme('light');
  }

  // click handler
  if(toggle){
    toggle.addEventListener('click', () => {
      const isDark = root.getAttribute('data-theme') === 'dark';
      const newTheme = isDark ? 'light' : 'dark';
      applyTheme(newTheme);
      localStorage.setItem('eco_theme', newTheme);
    });
  }
})();
</script>
<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js");
  }
</script>

</body>
</html>